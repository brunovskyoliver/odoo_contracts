# O2 Invoice Processing - Quick Start\n\n## What Was Added\n\nO2 Slovakia invoice PDF processing has been added to the Supplier Invoice Processor module.\n\n## Key Changes\n\n### File: `supplier_invoice_processor.py`\n\n**1. Updated Line Parsing Logic (Line ~592)**\n```python\nelif data.get('is_o2'):\n    data['lines'] = self._parse_o2_lines_from_text(text)\n```\n\n**2. Added New Method: `_parse_o2_lines_from_text()` (Line ~1487)**\n- Extracts monthly service charges\n- Extracts usage-based charges\n- Removes duplicates\n- Skips summary sections\n- Default 20% VAT for all services\n\n## How It Works\n\n### Detection\nO2 invoices are automatically detected if the PDF contains:\n- \"o2 slovakia\" (case-insensitive)\n- \"o2 sk\" (case-insensitive)\n\n### Extraction (First Page Only)\n1. Reads each line of extracted PDF text\n2. Looks for monthly services: `ServiceName  dd.mm.yyyy - dd.mm.yyyy  AmountEUR`\n3. Looks for usage items: `ServiceName  AmountEUR`\n4. Stops at \"Rekapitulácia DPH\" section\n5. Returns list of services with:\n   - description (service name)\n   - quantity (1.0)\n   - price_unit (EUR amount)\n   - vat_rate (20%)\n\n## Usage Example\n\n### In Odoo UI\n```\n1. Accounting > Vendors > Invoice Processor > Create\n2. Upload O2_invoice_7100133985.pdf\n3. Click \"Process PDF\"\n4. System extracts:\n   - e-Net Fér bez dát: 0.15€\n   - Mesačný poplatok VPN: 0.03€\n   - Volania do ostatných sietí SR: 0.2207€\n   - ... (more services)\n5. Review and click \"Create Invoice\"\n```\n\n### In Code\n```python\nprocessor = env['supplier.invoice.processor'].create({\n    'pdf_file': base64_encoded_pdf,\n    'pdf_filename': 'o2_invoice_7100133985.pdf'\n})\nprocessor.action_process_pdf()\nfor line in processor.line_ids:\n    print(f\"{line.name}: {line.price_unit}€\")\nprocessor.action_create_invoice()\n```\n\n## Sample Input/Output\n\n### Input: O2 Invoice PDF (First Page)\n```\nFaktúra č. 7100133985\nDátum vystavenia: 02.12.2025\nDátum splatnosti: 16.12.2025\n\nNOVEM IT s.r.o.\nIČO: 50282859\nDIČ: 2120427078\n\nNázov položky                    Fakturčné obdobie         Suma\ne-Net Fér bez dát               01.11.2025-30.11.2025    0.15€\nMesačný poplatok VPN            01.11.2025-30.11.2025    0.03€\nVolania do ostatných sietí SR                             0.2207€\n```\n\n### Output: Extracted Services\n```\n✓ e-Net Fér bez dát: 1 × 0.15€ (20% VAT)\n✓ Mesačný poplatok VPN: 1 × 0.03€ (20% VAT)\n✓ Volania do ostatných sietí SR: 1 × 0.2207€ (20% VAT)\n```\n\n## Parsing Patterns\n\n### Pattern 1: Monthly Services\n```regex\n([a-zA-Z0-9\\s\\-áäčďéěíľňóôšťúůýž]+?)\\s+\\d{1,2}\\.\\d{1,2}\\.\\d{4}\\s*-\\s*\\d{1,2}\\.\\d{1,2}\\.\\d{4}\\s+([\\d,\\.]+)\n```\nMatches: `ServiceName  01.01.2025 - 31.01.2025  12.34`\n\n### Pattern 2: Usage Items\n```regex\n^([a-zA-Z0-9\\s\\-áäčďéěíľňóôšťúůýž]+?)\\s+([\\d,\\.]+)\\s*€?\\s*$\n```\nMatches: `ServiceName  12.34` or `ServiceName  12.34€`\n\n## Supported Service Types\n\n- ✓ Mobile plans (e-Net, etc.)\n- ✓ VPN monthly charges\n- ✓ Call charges (domestic, international, roaming)\n- ✓ SMS charges\n- ✓ Data volume charges\n- ✓ Entertainment services\n- ✓ Parking charges\n- ✓ Special services\n\n## Limitations\n\n- **PDF Only**: Works with text-based PDFs (not scanned images)\n- **First Page**: As requested, only first page is processed\n- **Date Format**: Expects DD.MM.YYYY format\n- **Decimal Separator**: Accepts both comma (0,15) and dot (0.15)\n- **No Quantity Tracking**: All services extracted as quantity=1.0\n\n## Error Handling\n\n### If No Services Extracted\n1. Check PDF is text-based (not image-scanned)\n2. Verify it contains \"O2 Slovakia\" or \"O2 sk\"\n3. Check extracted_text field in processor record\n4. Review line breaks and spacing in PDF\n\n### If VAT Rate is Wrong\n1. O2 defaults to 20% for all services\n2. Manually adjust in Odoo UI after extraction\n3. Some services may need different rates:\n   - Parking: 0% VAT\n   - Entertainment: varies by provider\n\n## Testing\n\nTo test O2 processing:\n\n```python\n# In Odoo Console\nprocessor = env['supplier.invoice.processor'].search([('is_o2', '=', True)])[0]\nprint(f\"Invoice: {processor.invoice_number}\")\nprint(f\"Total: {processor.total_amount}€\")\nfor line in processor.line_ids:\n    total = line.quantity * line.price_unit\n    print(f\"  - {line.name}: {line.quantity} × {line.price_unit}€ = {total}€ ({line.vat_rate}% VAT)\")\n```\n\n## Files Modified\n\n- `models/supplier_invoice_processor.py`\n  - Added O2 to line parsing decision tree\n  - Added `_parse_o2_lines_from_text()` method\n\n## Files Created\n\n- `O2_INVOICE_PROCESSING.md` - Full documentation\n- `O2_INVOICE_PROCESSING_QUICKSTART.md` - This file\n\n## Next Steps\n\n1. Upload O2 invoice PDF to test\n2. Review extracted services\n3. Adjust product mappings if needed\n4. Create invoice in Odoo\n5. Report any issues with extraction\n\n## Support\n\nFor detailed information, see: `O2_INVOICE_PROCESSING.md`\n"